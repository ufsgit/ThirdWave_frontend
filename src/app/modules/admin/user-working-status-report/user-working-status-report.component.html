<div class="wrapper">
    <div class="main-panel">
        <div class="content">
            <div class="card">
               
                
                <div class="card-body">
                    <!-- Filter Section -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <label class="form-label">Department Filter</label>
                            <select 
                                [(ngModel)]="Selected_Department" 
                                (ngModelChange)="Apply_Filters()"
                                class="form-control">
                                <option *ngFor="let dept of Department_Data" [ngValue]="dept">
                                    {{dept.Department_Name}}
                                </option>
                            </select>
                        </div>
                        
                        <div class="col-md-4">
                            <label class="form-label">Search by Name</label>
                            <input 
                                type="text" 
                                [(ngModel)]="Search_Name"
                                (ngModelChange)="Apply_Filters()"
                                placeholder="Enter user name..."
                                class="form-control">
                        </div>
                        
                        <div class="col-md-4 d-flex align-items-end">
                            <button 
                                class="btn btn-primary me-2" 
                                (click)="Refresh_Data()"
                                [disabled]="issLoading">
                                <i class="fa fa-refresh" [class.fa-spin]="issLoading"></i>
                                Refresh
                            </button>
                            
                            <!-- <button 
                                class="btn btn-success" 
                                (click)="Export_To_Excel()"
                                [disabled]="issLoading">
                                <i class="fa fa-file-excel-o"></i>
                                Export
                            </button> -->
                        </div>
                    </div>

                    <!-- Results Summary -->
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <p class="text-muted">
                                Showing {{ Paginated_Users.length }} of {{ totalItems }} users
                                <span *ngIf="Selected_Department.Department_Id > 0">
                                    in {{ Selected_Department.Department_Name }}
                                </span>
                            </p>
                        </div>
                    </div>

                    <!-- Loading Spinner -->
                    <div *ngIf="issLoading" class="text-center p-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                        <p class="mt-2">Loading users...</p>
                    </div>

                    <!-- Users Table -->
                    <div *ngIf="!issLoading" class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="thead-dark">
                                <tr>
                                    <th>#</th>
                                    <th>User Name</th>
                                    <th>Department</th>
                                    <th>User Type</th>
                                    <th>Current Status</th>
                                    <th>Change Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let user of Paginated_Users; let i = index">
                                    <td>{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
                                    
                                    <!-- User Name -->
                                    <td>
                                        <div class="user-info">
                                            <span class="d-inline-block font-weight-bold">
                                                {{ user.User_Details_Name }}
                                            </span>
                                            <span class="dt-separator-v">&nbsp;</span>
                                            <small class="text-muted">ID: {{ user.User_Details_Id }}</small>
                                        </div>
                                    </td>
                                    
                                    <!-- Department -->
                                    <td>
                                        <span class="d-inline-block">{{ user.Department_Name }}</span>
                                    </td>
                                    
                                    <!-- User Type -->
                                    <td>
                                        <span class="d-inline-block">{{ user.User_Type_Name }}</span>
                                    </td>
                                    
                                    <!-- Current Working Status -->
                                    <td>
                                        <span [class]="getStatusBadgeClass(user.User_Status_Name)">
                                            {{ user.User_Status_Name }}
                                        </span>
                                    </td>
                                    
                                    <!-- Status Change Dropdown -->
                                    <td>
                                        <div class="status-change-container">
                                            <!-- Status Dropdown -->
                                            <select 
                                                [(ngModel)]="statusChangeTracker[user.User_Details_Id]"
                                                (ngModelChange)="onStatusChange(user, $event)"
                                                [disabled]="isChangingStatus[user.User_Details_Id]"
                                                class="form-control form-control-sm status-dropdown"
                                                [class.loading]="isChangingStatus[user.User_Details_Id]">
                                                
                                                <option *ngFor="let status of User_Status_Data" 
                                                        [value]="status.User_Status_Id">
                                                    {{ status.User_Status_Name }}
                                                </option>
                                            </select>
                                            
                                            <!-- Loading Indicator -->
                                            <div *ngIf="isChangingStatus[user.User_Details_Id]" 
                                                 class="status-loading-overlay">
                                                <i class="fa fa-spinner fa-spin"></i>
                                                <small class="text-muted d-block">Updating...</small>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                
                                <!-- No Data Row -->
                                <tr *ngIf="Filtered_User_Data.length === 0">
                                    <td colspan="6" class="text-center p-4">
                                        <div class="no-data">
                                            <i class="fa fa-users fa-3x text-muted mb-3"></i>
                                            <h5 class="text-muted">No users found</h5>
                                            <p class="text-muted">Try adjusting your filters or refresh the data</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div *ngIf="!issLoading && totalPages > 1" class="row mt-4">
                        <div class="col-md-12">
                            <nav aria-label="User pagination">
                                <ul class="pagination justify-content-center">
                                    <!-- Previous Button -->
                                    <li class="page-item" [class.disabled]="currentPage === 1">
                                        <a class="page-link" (click)="previousPage()" href="javascript:void(0)">
                                            <i class="fa fa-chevron-left"></i>
                                        </a>
                                    </li>
                                    
                                    <!-- Page Numbers -->
                                    <li class="page-item" 
                                        *ngFor="let page of [].constructor(totalPages); let i = index"
                                        [class.active]="currentPage === i + 1"
                                        [hidden]="totalPages > 10 && Math.abs(currentPage - (i + 1)) > 2 && i + 1 !== 1 && i + 1 !== totalPages">
                                        <a class="page-link" (click)="goToPage(i + 1)" href="javascript:void(0)">
                                            {{ i + 1 }}
                                        </a>
                                    </li>
                                    
                                    <!-- Next Button -->
                                    <li class="page-item" [class.disabled]="currentPage === totalPages">
                                        <a class="page-link" (click)="nextPage()" href="javascript:void(0)">
                                            <i class="fa fa-chevron-right"></i>
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                            
                            <!-- Page Info -->
                            <div class="text-center mt-2">
                                <small class="text-muted">
                                    Page {{ currentPage }} of {{ totalPages }}
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Status Legend -->
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="status-legend">
                                <h6>Status Legend:</h6>
                                <span class="badge badge-success me-2">Working</span>
                                <span class="badge badge-warning me-2">Leave</span>
                                <span class="badge badge-danger me-2">Resigned</span>
                                <span class="badge badge-secondary me-2">Other</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>